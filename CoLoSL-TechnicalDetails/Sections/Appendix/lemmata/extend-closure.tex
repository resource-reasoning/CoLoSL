\newpage	
\begin{lemma}[\extendRule-Confinement]\label{lem:extend-confinement}
For all $\lmod \AMods$, $s, r \in \LStates$ and $a \in \m{rg}(\lmod)$:
%
\[
\begin{array}{l}
	\begin{array}{@{} l @{}}
		s \composeL r \confines \lmod /|\\
		\m{potential}(a, s \composeL r) /|\\
		\left(\m{visible}(a, s) \lor \fst{\updateFP{a}} = \unitL \right) /|\\
		\left((s', r') \in a[s, r] \lor s' \composeL r' = a[s \composeL r] \right)
	\end{array}
	\implies s' \composeL r' \confines \lmod
\end{array}
\]
%
\begin{proof}
Pick an arbitrary $\lmod \in \AMods$, $s, s', r, r' \in \LStates$ and $a \in \m{rg}(\lmod)$ such that:
%
\begin{align}
	& s \composeL r \confines \lmod \label{LEF:Ass1}\\
	& \m{potential}(a, s \composeL r) \label{LEF:Ass2}\\
	& \m{visible}(a, s) \lor \fst{\updateFP{a}} = \unitL \label{LEF:Ass0}
\end{align}
%(\ref{LMS:Ass})
\textbf{RTS. } $s' \composeL r' \confines \lmod $.\\
There are two cases to consider:\\
\textbf{Case 1. }$[s' \composeL r'] = a[s \composeL r]$\\
From the definition of $\confines$ and (\ref{LEF:Ass1}) we know there exists a fence $\fence{}$ such that:
%
\begin{align}
	& s \composeL r \in \fence{} \label{LEF:Ass3}\\
	& \for{g \in \fence{}} \for{a \in \m{rg}(\lmod)} \nonumber\\
	& \quad \m{potential}(a, g) /|  (\m{visible}(a, g) \lor \fst{\updateFP{a}} = \unitL)  \implies a[g] \in \fence{} \label{LEF:Ass4}
\end{align}
%(\ref{LMS:Ass})
By definition of $\m{visible}$ and from (\ref{LEF:Ass2})-(\ref{LEF:Ass4}) and assumption of case 1. we have: 
%
\begin{align}
	& s' \composeL r' \in \fence{} \label{LEF:Ass5}
\end{align}
%
Finally by definition of $\confines$ and (\ref{LEF:Ass4})-(\ref{LEF:Ass5}) we have
%
\begin{align*}
	s' \composeL r' \confines \lmod
\end{align*}
%
as required.\\

\noindent\textbf{Case 2. }$(s', r') \in a[s, r]$\\
From the definitions of $a[s, r]$, $a[s \composeL r]$ and from the assumption of case 2. we have $s' \composeL r' = a[s \composeL r]$. The rest of the proof is identical to that of case 1.
\end{proof}
\end{lemma}
%
%
%
\begin{lemma}[\extendRule-Closure-1]\label{lem:extend-closure}
%
For all $\lmod{}, \lmod_{e} \in \AMods$, $n \in \Nats$ and $g, s_e \in \LStates$,
\[
%\begin{array}{l}
	g \confines \lmod /| s_e \confines \lmod_{e} 
	\implies
	\extendsAMUpto{\lmod \cup \lmod_{e}, \left( (\lmod, g) + (\lmod_{e}, s_e) \right)}{n}{s_{e}}{g}{\lmod_{e}}
%\end{array}
\]
%
where
%
\[
\begin{array}{@{} l  l @{}}
	\left( (\lmod, g) + (\lmod_{e}, s_e) \right)(\ca{}) \eqdef  & 
	\left\{
		(f', a[f']) \;\;\middle|
		\begin{array}{ l @{}}
			\left(a \in \lmod(\ca{}) |/ a \in \lmod_{e}(\ca{})  \right) /| \\
			f' \in \fence{}' /| \m{enabled}(a, f')	
		\end{array}		  
	\right\}\\
\end{array}
\]
%
and
%
\[
\begin{array}{@{} l l @{}}
	\fence{}' \eqdef & 
	\left\{
		f \composeL f_{e} \;\;\middle| 
		\begin{array}{l @{\hspace{5pt}} l @{}}
			\exsts{\fence{}, \fence{e}} & g \in \fence{} /| f \in \fence{} /| \fence{} \strictfences \lmod /| \\
			& s_{e} \in \fence{e} /| f_{e} \in \fence{e} /| \fence{e} \strictfences \lmod_{e} 
		\end{array}
	\right\}
\end{array}
\]
%
\begin{proof}
Pick an arbitrary $\lmod, \lmod_{e} \in \AMods$ and proceed by induction on the number of steps $n$. \\

\noindent\textbf{Base case }$n = 0$.\\
Pick an arbitrary $g, s_e \in \LStates$. Since $\lmod_{e} \subseteq \lmod \cup \lmod_{e}$, from the definition of $\downarrow_{0}$, we have $\extendsAMUpto{\lmod \cup \lmod_{e}, (\lmod, g) + (\lmod_{e}, s_e)}{0}{s_{e}}{g}{\lmod_{e}}$, as required.\\

\noindent\textbf{Inductive case }\\
Pick an arbitrary $g, s_e \in \LStates$ such that
%
\begin{align}
	& g \confines \lmod \label{LEC:Ass1}\\
	& s_e \confines \lmod_e \label{LEC:Ass2}\\
	& \gmod = (\lmod, g) + (\lmod_{e}, s_e) \label{LEC:Ass3}\\
	& \tag{I.H} \for{g', s_e'}  g' \confines \lmod /| s'_e \confines \lmod_e \implies \extendsAMUpto{\lmod \cup \lmod_{e}, \gmod}{(n-1)}{s_e'}{g'}{\lmod_{e}} \label{LEC:IH}
\end{align}
%
\textbf{RTS.}
%
\begin{align}
	& 
	\V{\ca{}}  \V{a\in \lmod_e(\ca{})} \nonumber \\
  &\quad (\m{potential}(a, s_e \composeL g) /| \m{visible}(a, s_e) => \nonumber\\
  & \quad\qquad\for{(s', r') \in a[s_e, g]} \extendsAMUpto{\lmod \cup \lmod_e, \gmod}{(n-1)}{s'}{r'}{\lmod_e}) \label{LEC:Goal0}\\
% 
	&\quad (\m{potential}(a, s_e \composeL g) /| \neg\m{visible}(a, s_e) => \nonumber\\
  & \quad\qquad \extendsAMUpto{\lmod \cup \lmod_e, \gmod}{(n-1)}{s_e}{a[s_e \composeL g] - s_e}{\lmod_e}) \label{LEC:Goal1}\\
%   
  &\quad \m{enabled}(a,s_e \composeL g)
  => (s_e \composeL g, a[s_e \composeL g])\in \gmod(\ca{})) \label{LEC:Goal2}\\
%  
  &\V{\ca{}}\V{a\in \left(\lmod \cup \lmod_e \right) (\ca{})}
  \m{potential}(a,s_e \composeL g) =>\null \nonumber \\
  &\ \m{reflected}(a, s_e \composeL g,\lmod_e(\ca{})) |/\null \nonumber \\
%  
  &\ \neg\m{visible}(a, s_e) /| \extendsAMUpto{\lmod \cup \lmod_e, \gmod}{(n-1)}{s_e}{a[s_e \composeL g] - s_e}{\lmod_e}  \label{LEC:Goal3}
\end{align}
%
%

\noindent\textbf{RTS. \ref{LEC:Goal0}}\\
Pick an arbitrary $\ca{}$, $a \in \lmod_e(\ca{})$ and $(s', r')$ such that
%
\begin{align}
	& \m{potential}(a, s_e \composeL g) /| \m{visible}(a, s_e) \label{LEC:Ass5}\\
	& (s', r') \in a[s_e, g] \label{LEC:Ass6}
\end{align}
%(\ref{LEC:Ass})
Since from (\ref{LEC:Ass5}) and the definition of $\m{potential}$ we have $s_e \composeL g \meetL \fst{a} \not= \emptyset$ and consequently, $s_e \meetL \fst{a} \not= \emptyset$, from (\ref{LEC:Ass2}) we have:
%
\begin{align}
	\fst{\updateFP{a}} \leq s_e /| \fst{\updateFP{a}} \disjoint g\label{LEC:Ass7}
\end{align}
% 
From (\ref{LEC:Ass5}), (\ref{LEC:Ass7}) and the definition of $\m{potential}$ we have:
%
\begin{align}
	\m{potential}(a, s_e) \label{LEC:Ass8}
\end{align}
%
On the other hand, from (\ref{LEC:Ass6}), (\ref{LEC:Ass7}) and the definitions of $a[s_e, g]$ and $\disjoint$, we have: 
%
\begin{align}
	& r' = g \label{LEC:Ass9}\\
	& a[s_e] = s' \label{LEC:Ass10}
\end{align}
%
Consequently, from (\ref{LEC:Ass2}), (\ref{LEC:Ass8}), (\ref{LEC:Ass5}), (\ref{LEC:Ass10}) and \lem~\ref{lem:extend-confinement} we have:
%
\begin{align}
	s' \confines \lmod_e  \label{LEC:Ass11}
\end{align}
%
Finally, from (\ref{LEC:Ass1}), (\ref{LEC:Ass11}), (\ref{LEC:Ass9}) and (\ref{LEC:IH}) we have:
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod}{(n-1)}{s'}{r'}{\lmod_e}
\end{align*}
%
as required.\\
%
%
%

\noindent\textbf{RTS. \ref{LEC:Goal1}}\\
Pick an arbitrary $\ca{}$, $a \in \lmod_e(\ca{})$ such that
%
\begin{align}
	& \m{potential}(a, s_e \composeL g) /| \neg\m{visible}(a, s_e) \label{LEC:Ass15}
\end{align}
%(\ref{LEC:Ass})
Since from (\ref{LEC:Ass15}) and the definition of $\m{potential}$ we have $s_e \composeL g \meetL \fst{a} \not= \emptyset$ and consequently, $s_e \meetL \fst{a} \not= \emptyset$, from (\ref{LEC:Ass2}) we have:
%
\begin{align}
	\fst{\updateFP{a}} \leq s_e /| \fst{\updateFP{a}} \disjoint g \label{LEC:Ass16}
\end{align}
% 
There are now two cases to consider: either $\fst{\updateFP{a}} > \unitL$; or $\fst{\updateFP{a}} = \unitL$.

If $\fst{\updateFP{a}} > \unitL$, then from (\ref{LEC:Ass16}) and the definition of $\m{visible}$ we have $\m{visible}(a, s_e)$. However, this contradicts our assumption in (\ref{LEC:Ass15}) and hence this is not a valid case.

On the other hand, if $\fst{\updateFP{a}} = \unitL$, then from (\ref{LEC:Ass15}), (\ref{LEC:Ass16}) and the definition of $\m{potential}$ we have:
%
\begin{align}
	\m{potential}(a, s_e) \label{LEC:Ass18}
\end{align}
%
From (\ref{LEC:Ass16}), the definitions of $a[g]$ and $\disjoint$ and since $\fst{\updateFP{a}} = \unitL$, we have: 
%
\begin{align}
	& a[s_e] = s_e \composeL \snd{\updateFP{a}} \label{LEC:Ass19}\\
	& a[s_e \composeL g] = s_e \composeL g \composeL \snd{\updateFP{a}} \label{LEC:ass20}
\end{align}
%
Consequently, since $\fst{\updateFP{a}} = \unitL$, from (\ref{LEC:Ass2}), (\ref{LEC:Ass18}), (\ref{LEC:Ass19}) and \lem~\ref{lem:extend-confinement} we have:
%
\begin{align}
	s_e \composeL \snd{\updateFP{a}} \confines \lmod_e  \label{LEC:ass21}
\end{align}
%
From (\ref{LEC:Ass1}), (\ref{LEC:ass21}) and (\ref{LEC:IH}) we have:
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod}{(n-1)}{s_e \composeL \snd{\updateFP{a}}}{g}{\lmod_e}
\end{align*}
%
and consequently, from \lem~\ref{lem:forget-closure}
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod}{(n-1)}{s_e} {g \composeL \snd{\updateFP{a}}}{\lmod_e}
\end{align*}
%
and finally from (\ref{LEC:ass20})
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod}{(n-1)}{s_e}{a[s_e  \composeL g] - s_e}{\lmod_e}
\end{align*}
%
as required.\\
%
%
%

\noindent\textbf{RTS. \ref{LEC:Goal2}}\\
Pick an arbitrary $\ca{}$, $a \in \lmod_e(\ca{})$ such that
%
\begin{align}
	& \m{enabled}(a, s_e \composeL g) \label{LEC:Ass20}
\end{align}
% (\ref{LEC:Ass})
Then from (\ref{LEC:Ass1}) -(\ref{LEC:Ass3}) and the definition of $(\lmod, g) + (\lmod_e, s_e)$ we have:
%
\begin{align*}
	(s_e \composeL g, a[s_e \composeL g]) \in \gmod
\end{align*}
%
as required.\\
%
%
%

\noindent\textbf{RTS. \ref{LEC:Goal3}}\\
Pick an arbitrary $\ca{}$, $a \in \left(\lmod \cup \lmod_e\right)(\ca{})$ such that
%
\begin{align}
	& \m{potential}(a, s_e \composeL g)  \label{LEC:Ass25}
\end{align}
%(\ref{LEC:Ass})
Since $a \in \lmod_e(\ca{}) |/  a \in\lmod(\ca{})$, there are two cases to consider. 

If the first disjunct is the case, the desired result holds trivially since from the definition of $\m{reflected}$ and (\ref{LEC:Ass25}) we have $\m{reflected}(a, s_e \composeL g, \lmod_e(\ca{})$ as required.

On the other hand, if the second disjunct is the case, then since from (\ref{LEC:Ass25}) and the definition of $\m{potential}$ we have $s_e \composeL g \meetL \fst{a} \not= \emptyset$ and consequently, $g \meetL \fst{a} \not= \emptyset$, from (\ref{LEC:Ass1}) we have:
%
\begin{align}
	\fst{\updateFP{a}} \leq g /| \fst{\updateFP{a}} \disjoint s_e \label{LEC:Ass27}
\end{align}
% 
From (\ref{LEC:Ass25}), (\ref{LEC:Ass27}) and the definition of $\m{potential}$ we have:
%
\begin{align}
	\m{potential}(a, g) \label{LEC:Ass28}
\end{align}
%
On the other hand, from (\ref{LEC:Ass27}) and the definitions of $a[s_e \composeL g]$ and $\disjoint$, we know there exists $g'$ such that: 
%
\begin{align}
	& a[s_e \composeL g] = s_e \composeL g' \label{LEC:Ass29}\\
	& a[g] = g'  \label{LEC:Ass30}
\end{align}
%
Consequently, from (\ref{LEC:Ass1}), (\ref{LEC:Ass28}), (\ref{LEC:Ass25}), (\ref{LEC:Ass30}) and \lem~\ref{lem:extend-confinement} we have:
%
\begin{align}
	g' \confines \lmod  \label{LEC:Ass31}
\end{align}
%
Finally, from (\ref{LEC:Ass2}), (\ref{LEC:Ass31}), (\ref{LEC:Ass29}), (\ref{LEC:IH}) we have:
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod}{(n-1)}{s_e}{a[s_e \composeL g] - s_e}{\lmod_e}
\end{align*}
%
as required.
\end{proof}
\end{lemma}
%
%
%
%
%
%
%
%
%
%
%
\begin{lemma}[\extendRule-closure-2]\label{extend-closure-2}
For all $\lmod_0, \lmod{}, \lmod_{e}, \gmod \in \AMods$, $n \in \Nats$ and $s, g, s_e \in \LStates$,
\[
\begin{array}{l}
	g \confines \lmod /| s_e \confines \lmod_{e} /| 
	\extendsAMUpto{\lmod, \gmod}{n}{s}{g-s}{\lmod_0}\\
	\qquad\implies
	\extendsAMUpto{\lmod \cup \lmod_{e}, \left( (\lmod, g) + (\lmod_{e}, s_e) \right)}{n}{s}{(g-s) \composeL s_e}{\lmod_{0}}
\end{array}
\]
%
where
%
\[
\begin{array}{@{} l  l @{}}
	\left( (\lmod, g) + (\lmod_{e}, s_e) \right)(\ca{}) \eqdef  & 
	\left\{
		(f', a[f']) \;\;\middle|
		\begin{array}{ l @{}}
			\left(a \in \lmod(\ca{}) |/ a \in \lmod_{e}(\ca{})  \right) /| \\
			f' \in \fence{}' /| \m{enabled}(a, f')	
		\end{array}		  
	\right\}\\
\end{array}
\]
%
and
%
\[
\begin{array}{@{} l l @{}}
	\fence{}' \eqdef & 
	\left\{
		f \composeL f_{e} \;\;\middle| 
		\begin{array}{l @{\hspace{5pt}} l @{}}
			\exsts{\fence{}, \fence{e}} & g \in \fence{} /| f \in \fence{} /| \fence{} \strictfences \lmod /| \\
			& s_{e} \in \fence{e} /| f_{e} \in \fence{e} /| \fence{e} \strictfences \lmod_{e} 
		\end{array}
	\right\}
\end{array}
\]
%
\begin{proof}
Pick an arbitrary $\lmod_0, \lmod, \lmod_{e}, \gmod \in \AMods$ and proceed by induction on the number of steps $n$. \\

\noindent\textbf{Base case }$n = 0$.\\
Pick an arbitrary $s, g, s_e \in \LStates$ such that $\extendsAMUpto{\lmod, \gmod}{n}{s}{g-s}{\lmod_0}$. We thus have $\lmod_{0} \subseteq \lmod$ and consequently $\lmod_{0} \subseteq \lmod \cup \lmod_{e}$; hence from the definition of $\downarrow_{0}$, we have $\extendsAMUpto{\lmod \cup \lmod_{e}, (\lmod, g) + (\lmod_{e}, s_e)}{0}{s_{e}}{g}{\lmod_{e}}$, as required.\\

\noindent\textbf{Inductive case }\\
Pick an arbitrary $s, r, g, s_e \in \LStates$ such that
%
\begin{align}
	& g \confines \lmod \label{LEC2:Ass1}\\
	& s_e \confines \lmod_e \label{LEC2:Ass2}\\
	& \gmod' = (\lmod, g) + (\lmod_{e}, s_e) /| g = s \composeL r \label{LEC2:Ass3} \\
	& \extendsAMUpto{\lmod, \gmod}{n}{s}{r}{\lmod_0} \label{LEC2:Ass4}\\
	& \for{s', g', s_e'}  g' \confines \lmod /| s'_e \confines \lmod_e /| \extendsAMUpto{\lmod, \gmod}{(n-1)}{s'}{g'-s'}{\lmod_0} \nonumber \\
	& \tag{I.H} \qquad \implies \extendsAMUpto{\lmod \cup \lmod_{e}, \gmod'}{(n-1)}{s'}{(g'-s') \composeL s_e'}{\lmod_{0}} \label{LEC2:IH}
\end{align}
%
\textbf{RTS.}
%
\begin{align}
	& 
	\V{\ca{}}  \V{a\in \lmod_0(\ca{})} \nonumber \\
  &\quad \m{potential}(a, g \composeL s_e) /| \m{visible}(a, s) => \nonumber\\
  & \quad\qquad\for{(s', r') \in a[s, r \composeL s_e]} \extendsAMUpto{\lmod \cup \lmod_e, \gmod'}{(n-1)}{s'}{r'}{\lmod_0} \label{LEC2:Goal0}\\
% 
	&\quad \m{potential}(a, g \composeL s_e) /| \neg\m{visible}(a, s) => \nonumber\\
  & \quad\qquad \extendsAMUpto{\lmod \cup \lmod_e, \gmod'}{(n-1)}{s}{a[g \composeL s_e] - s}{\lmod_0} \label{LEC2:Goal1}\\
%   
  &\quad \m{enabled}(a,g \composeL s_e)
  => (g \composeL s_e, a[g \composeL s_e])\in \gmod'(\ca{}) \label{LEC2:Goal2}\\
%  
  &\V{\ca{}}\V{a\in \left(\lmod \cup \lmod_e \right) (\ca{})}
  \m{potential}(a,g \composeL s_e) =>\null \nonumber \\
  &\ \m{reflected}(a, g \composeL s_e, \lmod_0(\ca{})) |/\null \nonumber \\
%  
  &\ \neg\m{visible}(a, s) /| \extendsAMUpto{\lmod \cup \lmod_e, \gmod'}{(n-1)}{s}{a[g \composeL s_e] - s}{\lmod_0}  \label{LEC2:Goal3}
\end{align}
%
%

\noindent\textbf{RTS. \ref{LEC2:Goal0}}\\
Pick an arbitrary $\ca{}$, $a \in \lmod_0(\ca{})$ and $(s', r')$ such that
%
\begin{align}
	& \m{potential}(a, g \composeL s_e) /| \m{visible}(a, s) \label{LEC2:Ass5}\\
	& (s', r') \in a[s, r \composeL s_e] \label{LEC2:Ass6}
\end{align}
%(\ref{LEC2:Ass})
Since from (\ref{LEC2:Ass5}) and the definition of $\m{potential}$ we have $s_e \composeL g \meetL \fst{a} \not= \emptyset$ and consequently, $g \meetL \fst{a} \not= \emptyset$, from (\ref{LEC2:Ass1}) we have:
%
\begin{align}
	\fst{\updateFP{a}} \leq g /| \fst{\updateFP{a}} \disjoint s_e \label{LEC2:Ass7}
\end{align}
% 
From (\ref{LEC2:Ass5}), (\ref{LEC2:Ass7}) and the definition of $\m{potential}$ we have:
%
\begin{align}
	\m{potential}(a, g) \label{LEC2:Ass8}
\end{align}
%
On the other hand, from (\ref{LEC2:Ass6}), (\ref{LEC2:Ass7}) and the definitions of $a[s, r \composeL s_e]$ and $\disjoint$, we know there exists $r''$: 
%
\begin{align}
	& r' = r'' \composeL s_e \label{LEC2:Ass9}\\
	& (s', r'') \in a[s, r]  \label{LEC2:Ass10}
\end{align}
%
Consequently, from (\ref{LEC2:Ass1}), (\ref{LEC2:Ass8}), (\ref{LEC2:Ass5}), (\ref{LEC2:Ass10}), \lem~\ref{lem:extend-confinement} and since $g = s \composeL r$ (\ref{LEC2:Ass3}), we have:
%
\begin{align}
	s' \composeL r'' \confines \lmod  \label{LEC2:Ass11}
\end{align}
%(\ref{LEC2:Ass})
On the other hand, from (\ref{LEC2:Ass4}), (\ref{LEC2:Ass8}), (\ref{LEC2:Ass5}) and (\ref{LEC2:Ass11}) we have:
%
\begin{align}
	\extendsAMUpto{\lmod, \gmod}{(n-1)}{s'}{r''}{\lmod_0} \label{LEC2:Ass12}
\end{align}
%
Finally, from (\ref{LEC2:Ass2}), (\ref{LEC2:Ass11}), (\ref{LEC2:Ass12}), (\ref{LEC2:Ass9}) and (\ref{LEC2:IH}) we have:
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod'}{(n-1)}{s'}{r'}{\lmod_0}
\end{align*}
%
as required.\\
%
%
%

\noindent\textbf{RTS. \ref{LEC2:Goal1}}\\
Pick an arbitrary $\ca{}$, $a \in \lmod_0(\ca{})$ such that
%
\begin{align}
	& \m{potential}(a, g \composeL s_e) /| \neg\m{visible}(a, s) \label{LEC2:Ass15}
\end{align}
%(\ref{LEC2:Ass})
Since from (\ref{LEC2:Ass15}) and the definition of $\m{potential}$ we have $g \composeL s_e \meetL \fst{a} \not= \emptyset$ and consequently, $g \meetL \fst{a} \not= \emptyset$, from (\ref{LEC2:Ass2}) we have:
%
\begin{align}
	\fst{\updateFP{a}} \leq g /| \fst{\updateFP{a}} \disjoint s_e \label{LEC2:Ass16}
\end{align}
% 
There are now two cases to consider: either $\fst{\updateFP{a}} > \unitL$; or $\fst{\updateFP{a}} = \unitL$.
If $\fst{\updateFP{a}} > \unitL$, then from (\ref{LEC2:Ass16}) and the definition of $\m{visible}$ we have $\m{visible}(a, g)$. Consequently from (\ref{LEC2:Ass16}) and the definition of $\m{potential}$ we have
%
\begin{align}
	\m{potential}(a, g) /| (\m{visible}(a, g) |/ \updateFP{a} = \unitL) \label{LEC2:Ass17}
\end{align}
%On the other hand, if $\fst{\updateFP{a}} = \unitL$, then from (\ref{LEC2:Ass15}), (\ref{LEC:Ass16}) and the definition of $\m{potential}$ we have:
%%
%\begin{align}
%	\m{potential}(a, s_e) \label{LEC:Ass18}
%\end{align}
%%
From (\ref{LEC2:Ass15}), (\ref{LEC2:Ass16}), the definitions of $a[g]$, $\disjoint$ and $\m{visible}$ we know there exists $r'$ such that: 
%
\begin{align}
	& a[s \composeL r] = s \composeL r' \label{LEC2:Ass19}\\
	& a[g \composeL s_e] = s \composeL r' \composeL s_e \label{LEC2:ass20}
\end{align}
%
Consequently, from (\ref{LEC2:Ass1}), (\ref{LEC2:Ass3}), (\ref{LEC2:Ass17}), (\ref{LEC2:Ass19}) and \lem~\ref{lem:extend-confinement} we have:
%
\begin{align}
	s \composeL r' \confines \lmod  \label{LEC2:ass21}
\end{align}
%
On the other hand, from (\ref{LEC2:Ass4}), (\ref{LEC2:Ass15}), (\ref{LEC2:Ass17}) and (\ref{LEC2:Ass19}) we have:
%
\begin{align}
	\extendsAMUpto{\lmod, \gmod}{(n-1)}{s}{r'}{\lmod_0} \label{LEC2:ass22}
\end{align}
%(\ref{LEC2:Ass})
From (\ref{LEC2:Ass2}), (\ref{LEC2:ass21}), (\ref{LEC2:ass22}) and (\ref{LEC2:IH}) we have:
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod'}{(n-1)}{s}{r' \composeL s_e}{\lmod_0}
\end{align*}
%
and finally from (\ref{LEC2:ass20})
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod'}{(n-1)}{s}{a[g \composeL s_e] - s}{\lmod_0}
\end{align*}
%
as required.\\
%
%
%

\noindent\textbf{RTS. \ref{LEC2:Goal2}}\\
Pick an arbitrary $\ca{}$, $a \in \lmod_0(\ca{})$ such that
%
\begin{align}
	& \m{enabled}(a, g \composeL s_e) \label{LEC2:Ass20}
\end{align}
% (\ref{LEC:Ass})
Then from (\ref{LEC2:Ass1}) -(\ref{LEC2:Ass3}) and the definition of $(\lmod, g) + (\lmod_e, s_e)$ we have:
%
\begin{align*}
	(g \composeL s_e, a[g \composeL s_e]) \in \gmod'
\end{align*}
%
as required.\\
%
%
%

\noindent\textbf{RTS. \ref{LEC2:Goal3}}\\
Pick an arbitrary $\ca{}$, $a \in \left(\lmod \cup \lmod_e\right)(\ca{})$ such that
%
\begin{align}
	& \m{potential}(a, g \composeL s_e)  \label{LEC2:Ass25}
\end{align}
%(\ref{LEC:Ass})
Since $a \in \lmod_e(\ca{}) |/  a \in\lmod(\ca{})$, there are two cases to consider. \\
%If the first disjunct is the case, the desired result holds trivially since from the definition of $\m{reflected}$ and (\ref{LEC:Ass25}) we have $\m{reflected}(a, s_e \composeL g, \lmod_e(\ca{})$ as required.

\noindent\textbf{Case 1. }$a \in \lmod_e(\ca{})$\\
Since from (\ref{LEC2:Ass25}) and the definition of $\m{potential}$ we have $g \composeL s_e \meetL \fst{a} \not= \emptyset$ and consequently, $s_e \meetL \fst{a} \not= \emptyset$, from (\ref{LEC2:Ass2}) and the assumption of the case we have:
%
\begin{align}
	\fst{\updateFP{a}} \leq s_e /| \fst{\updateFP{a}} \disjoint g \label{LEC2:Ass26}
\end{align}
% 
From (\ref{LEC2:Ass25}), (\ref{LEC2:Ass26}) and the definition of $\m{potential}$ we have:
%
\begin{align}
	\m{potential}(a, s_e) \label{LEC2:Ass27}
\end{align}
%
Since either $\fst{\updateFP{a}} > \unitL$; or $\fst{\updateFP{a}} = \unitL$, from (\ref{LEC2:Ass26}) and the definition of $\m{visible}$ we have:
%
\begin{align}
	\m{visible}(a, s_e) |/ \fst{\updateFP{a}} = \unitL \label{LEC2:Ass28}
\end{align}
%
On the other hand, from (\ref{LEC2:Ass26}) and the definitions of $a[g \composeL s_e]$ and $\disjoint$, we know there exists $s_e'$ such that: 
%
\begin{align}
	& a[g \composeL s_e] = g \composeL s_e' \label{LEC2:Ass29}\\
	& a[s_e] = s_e'  \label{LEC2:Ass30}
\end{align}
%
Consequently, from (\ref{LEC2:Ass2}), (\ref{LEC2:Ass27})-(\ref{LEC2:Ass28}), (\ref{LEC2:Ass30}) and \lem~\ref{lem:extend-confinement} we have:
%
\begin{align}
	s_e' \confines \lmod_e  \label{LEC2:Ass31}
\end{align}
%
From (\ref{LEC2:Ass3}) and \lem~\ref{lem:closure-downward-closed} we have:
%
\begin{align}
	\extendsAMUpto{\lmod, \gmod}{(n-1)}{s}{r}{\lmod_0}  \label{LEC2:Ass32}
\end{align}
%
Finally, from (\ref{LEC2:Ass1}), (\ref{LEC2:Ass31}), (\ref{LEC2:Ass32}), (\ref{LEC:IH}) we have:
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod'}{(n-1)}{s}{r \composeL s_e'}{\lmod_0}
\end{align*}
%
and thus from (\ref{LEC2:Ass3}) and (\ref{LEC2:Ass29}) 
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod'}{(n-1)}{s}{a[g \composeL s_e] - s}{\lmod_0}
\end{align*}
%
as required.\\

\noindent\textbf{Case 2. }$a \in \lmod(\ca{})$\\
Since from (\ref{LEC2:Ass25}) and the definition of $\m{potential}$ we have $g \composeL s_e \meetL \fst{a} \not= \emptyset$ and consequently, $g \meetL \fst{a} \not= \emptyset$, from (\ref{LEC2:Ass1}) and the assumption of the case we have:
%
\begin{align}
	\fst{\updateFP{a}} \leq g /| \fst{\updateFP{a}} \disjoint s_e \label{LEC2:Ass36}
\end{align}
% 
From (\ref{LEC2:Ass25}), (\ref{LEC2:Ass36}) and the definition of $\m{potential}$ we have:
%
\begin{align}
	\m{potential}(a, g) \label{LEC2:Ass37}
\end{align}
%(\ref{LEC2:Ass})
Consequently, from (\ref{LEC2:Ass4}), the assumption of the case we have:
%
\begin{align*}
	&\m{reflected}(a, g, \lmod_0(\ca{})) |/ \\
	&\neg\m{visible}(a, s) /| \exsts{r'} a[g] = s \composeL r' /| \extendsAMUpto{\lmod, \gmod}{(n-1)}{s}{r'}{\lmod_0}
\end{align*}
%
There are two cases to consider:\\

\noindent\textbf{Case 2.1.} 
%
$
	\neg\m{visible}(a, s) /| \exsts{r'} a[g] = s \composeL r' /| \extendsAMUpto{\lmod, \gmod}{(n-1)}{s}{r'}{\lmod_0}
$
%
Since either $\fst{\updateFP{a}} > \unitL$; or $\fst{\updateFP{a}} = \unitL$, from (\ref{LEC2:Ass36}) and the definition of $\m{visible}$ we have:
%
\begin{align}
	\m{visible}(a, g) |/ \fst{\updateFP{a}} = \unitL \label{LEC2:Ass38}
\end{align}
%
From (\ref{LEC2:Ass1}), (\ref{LEC2:Ass37})-(\ref{LEC2:Ass38}), the assumption of case 2.1. and \lem~\ref{lem:extend-confinement} we have:
%
\begin{align}
	s \composeL r' \confines \lmod  \label{LEC2:Ass39}
\end{align}
%
On the other hand, from (\ref{LEC2:Ass36}) and the definitions of $a[g \composeL s_e]$ and $\disjoint$, and the assmption of the case we have: 
%
\begin{align}
	& a[g \composeL s_e] = s \composeL r' \composeL s_e \label{LEC2:Ass40}
\end{align}
%
Finally, from (\ref{LEC2:Ass2}), (\ref{LEC2:Ass39}), the assumption of the case and (\ref{LEC:IH}) we have:
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod'}{(n-1)}{s}{r' \composeL s_e}{\lmod_0}
\end{align*}
%
and thus from (\ref{LEC2:Ass40}) 
%
\begin{align*}
	\extendsAMUpto{\lmod \cup \lmod_{e}, \gmod'}{(n-1)}{s}{a[g \composeL s_e] - s}{\lmod_0}
\end{align*}
%
as required.\\

\noindent\textbf{Case 2.2.} $	\m{reflected}(a, g, \lmod_0(\ca{}))$\\
Pick an arbitrary $l \in \LStates$ such that 
%
\begin{align}
	\fst{a} \leq g \composeL s_e \composeL l \label{LEC2:Ass41}
\end{align} 
%
From the assumption of the case and the definition of $\m{reflected}$ we then have
%
\begin{align}
	\exsts{a' \in \lmod_0(\ca{})} \updateFP{a'} = \updateFP{a} /| \fst{a'} \leq g \composeL s_e \composeL r \label{LEC2:Ass42}
\end{align}
%
Thus from (\ref{LEC2:Ass41}), (\ref{LEC2:Ass42}) and the definition of $\m{reflected}$ we have:
%
\begin{align*}
	\m{reflected}(a, g \composeL s_e, \lmod_0(\ca{}))
\end{align*}
%
as required.
%
\end{proof}
\end{lemma}